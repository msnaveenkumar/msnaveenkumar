package com.qmetry.qaf.example.test;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;

import java.io.File;
import java.io.IOException;
import java.util.Iterator;
import java.util.Map;

public class JsonItemCounter_New {

    public static void main(String[] args) {
        JsonItemCounter_New itemCounter = new JsonItemCounter_New(); // Instance of the class

        try {
            // Path to the JSON file
            File jsonFile = new File("test.json");

            // Parse the JSON file
            ObjectMapper mapper = new ObjectMapper();
            JsonNode rootNode = mapper.readTree(jsonFile);

            // Traverse and count items within "datasets"
            JsonNode datasetsNode = rootNode.get("datasets");
            if (datasetsNode != null && datasetsNode.isArray()) {
                for (JsonNode dataset : datasetsNode) {
                    // Use the instance methods
                    itemCounter.countItems(dataset, "reports");
                    itemCounter.countItems(dataset, "name");
                    itemCounter.countItems(dataset, "description");
                }
            }

        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    // Method to count items in a given field
    public void countItems(JsonNode dataset, String fieldName) {
        JsonNode fieldNode = dataset.get(fieldName);

        if (fieldNode != null) {
            if (fieldNode.isArray()) {
                System.out.println(fieldName + ": " + fieldNode.size() + " items");
            } else if (fieldNode.isObject()) {
                int count = countObjectFields(fieldNode);
                System.out.println(fieldName + ": " + count + " items");
            } else {
                System.out.println(fieldName + ": 1 item");
            }
        } else {
            System.out.println(fieldName + ": No items found");
        }
    }

    // Method to count the number of fields in a JSON object
    public int countObjectFields(JsonNode objectNode) {
        Iterator<Map.Entry<String, JsonNode>> fields = objectNode.fields();
        int count = 0;
        while (fields.hasNext()) {
            fields.next();
            count++;
        }
        return count;
    }
}
